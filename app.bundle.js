!function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);const n=document.getElementById("widget");new class{constructor(e){this.container=e,this.addTicket=this.addTicket.bind(this),this.recordData=this.recordData.bind(this),this.timer=this.timer.bind(this),this.elem=null}createWidget(){const e=document.createElement("div");e.classList.add("widget-container"),e.innerHTML='\n\t\t<div class="list"></div>\n      <div class="footer">\n      <form class="form">\n        <input class="form-input" name="input" type="text">\n      </form>\n      <div class="actions">\n        <div class="video"><img src="../img/camcorder.png"></div>\n        <div class="audio"><img src="../img/microphone.png"></div>\n      </div>\n      <div class="record hidden">\n        <div class="stop">&#10004</div>\n        <div class="time">0</div>\n        <div class="cancel">&#10006</div>\n      </div>\n      </div>\n\t\t',this.container.appendChild(e),document.querySelector(".video").addEventListener("click",()=>{this.recordData("video")}),document.querySelector(".audio").addEventListener("click",()=>{this.recordData("audio")}),document.querySelector(".form").addEventListener("submit",this.addTicket)}addTicket(e){e.preventDefault(),this.elem=document.createElement("span"),this.elem.textContent=e.target.input.value,this.getPosition()}getPosition(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{const{latitude:t,longitude:i}=e.coords;this.showTicket(t.toFixed(5),i.toFixed(5))},e=>{this.showModal(),console.error(e)})}resetInput(){this.container.querySelector(".form-input").value=""}showTicket(e,t){const i=document.querySelector(".list"),n=document.createElement("div");n.classList.add("ticket"),n.innerHTML=`\n       <div class="elem"></div>\n       <div class="date">${(new Date).toLocaleString()}</div>\n       <div class="geo">[${e},${t}]</div>\n    `,i.insertAdjacentElement("afterbegin",n),this.container.querySelector(".elem").insertAdjacentElement("afterbegin",this.elem),this.resetInput()}showModal(){const e=document.createElement("div");e.classList.add("modal"),e.innerHTML='\n      <div class="modal-text">Something is wrong  \n      <p>Sorry, but we can\'t determine your location, \n         please give us permission on use geolocation, \n         or text your coordinates\n      </p>\n      <p>Comma-separated latitude and longitude</p>\n      <form class="modal-form">\n        <input class="modal-input" name="modal" type="text">\n        <button type="reset" class="reset">Cancel</button>\n        <button type="submit" class="ok">Ok</button>\n      </form>\n      </div>\n    ',this.container.querySelector(".widget").appendChild(e),this.container.querySelector(".modal-input").addEventListener("input",this.deleteError),this.container.querySelector(".modal-form").addEventListener("submit",e=>{e.preventDefault();let t=this.checkValidity(e.target.modal.value);if(t){t=t[0].split(",");const e=t[0].trim(),i=t[1].trim();this.hideModal(),this.showTicket(e,i)}else this.showError(e.target,"Wrong format position")}),this.container.querySelector(".modal-form").addEventListener("reset",e=>{e.preventDefault(),this.hideModal()})}hideModal(){this.container.querySelector(".modal").remove(),this.resetInput()}checkValidity(e){return e.match(/^\[?\d+\.\d+,\s?\-?\d+\.\d+\]?$/gm)}showError(e,t){e.focus();const i=document.createElement("div");i.dataset.id="error",i.className="form-error",i.textContent=""+t,document.body.appendChild(i);const{top:n,left:r}=e.getBoundingClientRect();i.style.top=window.scrollY+n+e.offsetHeight/2+"px",i.style.left=window.scrollX+r+e.offsetWidth/3+"px"}deleteError(){document.querySelector(".form-error")&&document.querySelector(".form-error").remove()}timer(){const e=this.container.querySelector(".time");let t=1;this.timerId=setInterval(()=>{e.textContent=t,t++},1e3)}recordData(e){this.container.querySelector(".record").classList.remove("hidden"),this.container.querySelector(".actions").classList.add("hidden"),this.timer(),(async()=>{if(navigator.mediaDevices||window.MediaRecorder)try{const t=document.createElement(e);let i;if(t.controls=!0,"audio"===e)i=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});else{i=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0});const e=document.createElement("div");e.classList.add("box"),e.appendChild(t),this.container.querySelector(".footer").insertAdjacentElement("afterbegin",e),t.srcObject=i,t.play()}const n=new MediaRecorder(i),r=[];n.addEventListener("dataavailable",e=>{r.push(e.data)}),n.addEventListener("stop",()=>{t.srcObject=null;const e=new Blob(r);t.src=URL.createObjectURL(e)}),this.elem=t,n.start(),this.container.querySelector(".record").addEventListener("click",e=>{e.target.classList.contains("stop")?(clearInterval(this.timerId),this.container.querySelector(".time").textContent="0",i.getTracks().forEach(e=>e.stop()),this.container.querySelector(".record").classList.add("hidden"),this.container.querySelector(".actions").classList.remove("hidden"),this.getPosition()):e.target.classList.contains("cancel")&&(n.stop(),i.getTracks().forEach(e=>e.stop()),this.container.querySelector(".record").classList.add("hidden"),this.container.querySelector(".actions").classList.remove("hidden"))})}catch(e){console.error(e)}})()}}(n).createWidget();i.p,i.p}]);